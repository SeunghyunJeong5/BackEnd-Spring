
1. AWS EC2에 Ubuntu Linux 인트턴스(VM) 생성

2. Spring Boot 에서 배포파일 생성(runconfiguration들어가기)
	- JAR 파일 : 내장 톰캣으로 배포, 타임리프로 개발(뷰페이지를)
	- WAR 파일 : 외장 톰캣으로 사용, JSP
	
runconriguration들어가기
gradle task 더블클릭
add 눌러서 bootJar 명령어 넣기
working directory에 ${workspace_loc:/sbb}넣기
그리고 apply 하고 run
C:\workspace-STS4\sbb\build\libs 이 경로로 탐색기로 접속하면 jar 파일이 있음
배포파일을 : java -jar sbb-0.0.1-SNAPSHOT.jar하면 압축이 풀리는거 같음.


3. VM에 접속 후 기본 세팅
	- 컴퓨터 이름 변경
	ubuntu@ip-172-31-34-33:~$
	<계정명@서버명:현재작업폴더$>
	
	ls -la /etc/hostname
	이렇게 하면 권한을 확인할수있음.

	sudo vi /etc/hostname
	dd 눌러서 삭제하고
	i눌러서 srv1이라고 넣고 esc누르기
	:wq! 눌러서 빠져나오기
		
	
	- 시스템의 시간대 변경 : 서울 시간대로 설정
	sudo ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime 
	입력하고 date 쳐보면 바뀜




4. VM에 JDK 17버전 설치 : jar 파일의 압축을 풀 수 있다.

java 라고 쳐보면 입력어를 안내해줌
sudo apt update 를 먼저 입력하고,
sudo apt install openjdk-17-jre-headless 라고 입력하면됨.
java -version 쳐서 확인



5. sbb-0.0.1-SNAPSHOT.jar을 서버에 전송
	- 업로드할 폴더 생성
	cd ~ 를 치고
	mkdir sbb 로 sbb폴더를 생성하고
	ls -la (현재 로그온한 계정이 쓰기 권한이 있는지 확인해야함)
	
	파일질라 실행
	파일누르고 사이트관리자에서 새사이트만들고 sftp로 바꾸고
	AWS에서 공용아이피 불러오고
	키파일로 바꾸고(ppk파일 찾아서 불러오고)
	ubuntu로 설정하고
	연결
	
	그리고 sbb폴더를 찾아서 jar파일을 드래그해서 올림
	cd sbb 치고 
	ls 치면 
	폴더안에 파일이 들어가있는게 확인됨
	
	cd sbb
	java -jar sbb-0.0.1-SNAPSHOT.jar 치면 작동이됨
	(이러면 jar파일은 내장 톰캣이 있어서 서비스가 바로 작동됨) --> 지금은 9696포트로 작동되고있는데 이걸 바꿀거임
	
6. AWS 방화벽에서 서비스되는 포트를 오픈
	보안탭가서 보안그룹 누르고 인바운드규칙편집하고
	TCP9696하고 80번포트 둘다 열기
	포트범위 하고 anywhere ip4하고 저장
	그리고 웹에 공용아이피:9696/하면 접속이 됨.
	
	
	그리고 이걸 백그라운드로 작동이 되게 바꿔야됨.
	putty창을 하나 더띄우고 ubuntu 계정으로 접속


7. 작동중인 서비스 확인	
	ps -ef | grep java | grep sbb 이렇게 입력
	
	ps -ef 치면 전체다 나옴
	
	
	(http://3.34.124.201:9696/h2-console/ 이걸치면 아직 접속이 안되는데
	cd ~ 치고
	ls -la 치면 mv.db가 만들어져있는게 나옴)
	
	
	UID : 계정에게 부여되는 고유번호
	PID : 프로세스에게 부여되는 고유번호
	GID : 그룹에게 부여되는 고유번호 
	
	프로세스 강제종료 (실행중인 서비스를 강제종료)
	sudo kill -9 PID 
	
	
	
	어쨌든 ps -ef | grep java | grep sbb 치면
	나오는 앞의 번호가 PID이므로 치면됨
	
	
	
	포트번호 바꾸고 application.propwerties에서
	그리고 build.gradle에서 버전 바꾸고 0.0.2로
	그리고 다시 run configuration(gradle task-new...)해서 같은과정 반복하고 run하면
	cd sbb 치고
	java -jar sbb-0.0.2-SNAPSHOT.jar 치면 작동이됨.
	이렇게하면 작동이 안되는데 application.propwerties에서 local2로 일단 바꿈


8. 9696 포트서비스 jar 파일을 80번 포트에 매핑
	주의 : 80번 포트로 서비스 시작할때는 sudo 명령어가 필요함
	sudo java -jar sbb-0.0.2-SNAPSHOT.jar
	
	sudo java -Dserver.port=80 -jar sbb-0.0.1-SNAPSHOT.jar

이러면 그냥 공용ip주소 넣으면 접속됨. 그리고 나중에 도메인 구입해서 ip주소를 매핑하면 도메인으로 갈수있음.



9. 서비스 작동시 백그라운드 모드로 작동 : &


